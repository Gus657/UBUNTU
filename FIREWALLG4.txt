#FIREWALL GRUPO 4
#SO1A - 2018
clear
echo -e "\n\t\t\t\tFIREWALL GRUPO 4"
echo -e "\t\t\t\t  SO1A - 2018\n"

#SE LIMPIAN LAS CONFIGURACIONES ANTERIORES QUE PUEDAN EXISTIR
echo -e "LIMPIANDO CONFIGURACIONES..."
iptables -F 
iptables -X
iptables -Z
iptables -t nat -F

#SE COLOCAN LAS CONFIGURACIONES INICIALES O GENERALES
echo -e "CONFIGURACIONES BASICAS..."
iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P INPUT ACCEPT
iptables -t nat -P PREROUTING ACCEPT
iptables -t nat -P POSTROUTING ACCEPT

#SE CIERRAN LAS ENTRADAS POR LOS PUERTOS QUE NO SE UTILIZARAN
echo -e "CERRANDO PUERTOS..."
iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 10000 -j DROP
iptables -A INPUT -s 0.0.0.0/0 -p udp --dport 10000 -j DROP
iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 80 -j DROP
iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 20 -j DROP
iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 21 -j DROP
iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 53 -j DROP
iptables -A INPUT -s 0.0.0.0/0 -p udp --dport 53 -j DROP
iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 3306 -j DROP
iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 1:1024 -j DROP
iptables -A INPUT -s 0.0.0.0/0 -p udp --dport 1:1024 -j DROP

#SE CONCEDE ACCESO TOTAL A LAS MAUQUINAS DEL GRUPO
echo -e "CONCEDIENDO ACCESO A MAQUINAS INTERNAS..."
#iptables -A INPUT -s 0.0.0.0/0 -j ACCEPT
#iptables -A OUTPUT -s 0.0.0.0/0 -j ACCEPT

#SE ENMASCARA CUALQUIER IP SALIENTE CON UNA PUBLICA
echo -e "ENMASCARAMIENTO..."
#iptables -t nat -A POSTROUTING -s 0.0.0.0/0 -o eth0 -j MASQUERADE
#echo 1 > /proc/sys/net/ipv4/ip_forward

echo -e "\n\t\t\t\t     LISTO\n\n"
iptables -L -n
echo -e "\n"
